"use strict";const DEBUG=!1,CACHE_VERSION="1.4.3",CACHE_NAME="upgrade4me-cache-v1.4.3",CRITICAL_ASSETS=["/","/index.html","/offline.html","/datenschutz.html","/impressum.html","/agb.html","/assets/fonts/Roboto-Regular.woff2","/assets/fonts/Roboto-Medium.woff2","/assets/fonts/Roboto-Bold.woff2","/assets/logo/logo_450.webp","/assets/favicon/favicon-16x16.png","/assets/favicon/favicon-32x32.png","/assets/favicon/android-chrome-192x192.png","/assets/favicon/android-chrome-512x512.png","/assets/favicon/apple-touch-icon.png"],IMAGES=["/assets/img/poster_intro.jpg","/assets/img/poster_main.jpg","/assets/img/concept_background.webp","/assets/img/team_background.webp","/assets/img/shop_background.webp","/assets/img/company_background.webp","/assets/img/faq_background.webp","/assets/img/location_background.webp","/assets/img/faq_background.webp","/assets/img/kontakt_background.webp","/assets/img/team_elena.webp","/assets/img/team_mischa.webp","/assets/img/team_phillip.webp","/assets/img/team_regina.webp","/assets/img/shopping_cart_company.webp","/assets/img/shopping_cart_regular.webp","/assets/img/gallery_1.webp","/assets/img/gallery_2.webp","/assets/img/gallery_3.webp","/assets/img/gallery_4.webp","/assets/img/gallery_5.webp","/assets/img/gallery_6.webp","/assets/img/gallery_7.webp","/assets/img/gallery_8.webp","/assets/img/gallery_9.webp","/assets/img/gallery_10.webp","/assets/img/gallery_11.webp","/assets/img/concept_background_medium.webp","/assets/img/team_background_medium.webp","/assets/img/shop_background_medium.webp","/assets/img/company_background_medium.webp","/assets/img/location_background_medium.webp","/assets/img/faq_background_medium.webp","/assets/img/kontakt_background_medium.webp","/assets/img/concept_background_small.webp","/assets/img/team_background_small.webp","/assets/img/shop_background_small.webp","/assets/img/company_background_small.webp","/assets/img/location_background_small.webp","/assets/img/faq_background_small.webp","/assets/img/feedbak_background.webp","/assets/img/faq_background_small.webp","/assets/img/kontakt_background_small.webp","/assets/img/shop_background_very_small.webp","/assets/img/kontakt_termin_vereinbaren.webp","/assets/img/ssl_certificate.webp","/assets/img/four-secrets.webp","/assets/img/personal-coaching.webp","/assets/img/tcm.webp"],VIDEOS=["/assets/video/intro.mp4","/assets/video/intro_wa.mp4","/assets/video/main_wa.mp4"],ASSETS_TO_CACHE=[...CRITICAL_ASSETS,...IMAGES,...VIDEOS],CACHE_STRATEGIES={CACHE_FIRST:"cache-first",NETWORK_FIRST:"network-first",STALE_WHILE_REVALIDATE:"stale-while-revalidate"},ASSET_STRATEGIES={CRITICAL:CACHE_STRATEGIES.CACHE_FIRST,IMAGES:CACHE_STRATEGIES.STALE_WHILE_REVALIDATE,VIDEOS:CACHE_STRATEGIES.NETWORK_FIRST},STORAGE_THRESHOLDS={MINIMUM:104857600,MEDIUM:524288e3},BLOCKED_PROTOCOLS=["chrome-extension:","moz-extension:","safari-extension:","edge-extension:"],BLOCKED_DOMAINS=["google-analytics.com","doubleclick.net","facebook.com","google.com","stripe.com","googleapis.com","gstatic.com","firebase.com","emailjs.com","firebaseapp.com","firebaseio.com","firebase-settings.crashlytics.com","cloudflareinsights.com"];async function logDebug(e,s){false}async function checkStorageAndDevice(){try{const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if("storage"in navigator&&"estimate"in navigator.storage){const{usage:s,quota:a}=await navigator.storage.estimate(),t=a-s;if(t<STORAGE_THRESHOLDS.MINIMUM||e)return CRITICAL_ASSETS;if(t<STORAGE_THRESHOLDS.MEDIUM)return[...CRITICAL_ASSETS,...IMAGES]}return ASSETS_TO_CACHE}catch(e){return console.warn("Fehler bei Storage-PrÃ¼fung:",e),CRITICAL_ASSETS}}async function cacheAsset(e,s,a=3){for(let t=0;t<a;t++)try{const a=await fetch(s);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return void await e.put(s,a)}catch(e){if(t===a-1)return console.warn(`Failed to cache ${s} after ${a} attempts:`,e),Promise.resolve();await new Promise((e=>setTimeout(e,1e3*Math.pow(2,t))))}}async function handleFetch(e,s){const a=await caches.open(CACHE_NAME);switch(s){case CACHE_STRATEGIES.CACHE_FIRST:const s=await a.match(e);return s||fetchAndCache(e,a);case CACHE_STRATEGIES.NETWORK_FIRST:try{return await fetchAndCache(e,a)}catch(s){const t=await a.match(e);if(t)return t;throw s}case CACHE_STRATEGIES.STALE_WHILE_REVALIDATE:const t=await a.match(e),i=fetchAndCache(e,a);return t||i;default:return fetchAndCache(e,a)}}async function fetchAndCache(e,s){const a=await fetch(e);if(200===a.status){e.url.endsWith(".mp4")&&await checkStorageAndDevice()!==ASSETS_TO_CACHE||await s.put(e,a.clone())}return a}self.addEventListener("install",(e=>{e.waitUntil((async()=>{try{const e=await caches.open(CACHE_NAME),s=await checkStorageAndDevice();let a=0;s.length;await Promise.all(s.map((async s=>{await cacheAsset(e,s),a++}))),await self.skipWaiting()}catch(e){console.error("Install failed:",e)}})())})),self.addEventListener("activate",(e=>{e.waitUntil((async()=>{try{const e=await caches.keys();await Promise.all(e.filter((e=>{const s=e.match(/upgrade4me-cache-v(\d+\.\d+\.\d+)/);if(!s)return!0;return"1.4.3"!==s[1]})).map((e=>caches.delete(e)))),await clients.claim()}catch(e){console.error("Activation failed:",e)}})())})),self.addEventListener("fetch",(e=>{!function(e){try{const s=new URL(e.url);return!!BLOCKED_PROTOCOLS.includes(s.protocol)||(!!BLOCKED_DOMAINS.some((e=>s.hostname.includes(e)))||(!!s.pathname.includes("/api/")||!!s.pathname.includes("/stripe/")))}catch(e){return console.warn("URL-Parsing fehlgeschlagen:",e),!0}}(e.request)?"GET"===e.request.method&&e.request.url.startsWith(self.location.origin)&&e.respondWith((async()=>{try{let s=CACHE_STRATEGIES.CACHE_FIRST;const a=new URL(e.request.url);return a.pathname.startsWith("/assets/video/")?s=CACHE_STRATEGIES.NETWORK_FIRST:a.pathname.startsWith("/assets/img/")&&(s=CACHE_STRATEGIES.STALE_WHILE_REVALIDATE),await handleFetch(e.request,s)}catch(s){if(console.error("Fetch failed:",s),"navigate"===e.request.mode){const e=await caches.match("/offline.html");if(e)return e}throw s}})()):e.respondWith(fetch(e.request))}));